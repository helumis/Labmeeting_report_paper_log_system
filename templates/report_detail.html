{% extends "_base.html" %}
{% block content %}

<h1>{{ report.report_title }}</h1>
<p>{{ report.report_summary }}</p>
{% if report.slides_link %}
<p>Slides / Paper link: <a href="{{ report.slides_link }}" target="_blank">{{ report.slides_link }}</a></p>
{% endif %}
<p>Upload by: {{ user.display_name if user else "Unknown" }}</p>
<p>Meeting: {{ meeting.meeting_title if meeting else "—" }}</p>

{% if report.paper %}
<h2>Paper Info</h2>
<p>Title: {{ report.paper.paper_title }}</p>
<p>Published: {{ report.paper.published_year }} / {{ report.paper.published_month }}</p>
<p>Journal/Conference: {{ report.paper.journal_or_conference }}</p>

{% if report.paper.authors %}
<h3>Authors & Affiliations</h3>
<ul>
  {% for author in report.paper.authors %}
  <li>
    {{ author.name }}
    {% if author.affiliations %}
      — Affiliations: 
      {% for aff in author.affiliations %}
        {{ aff.name }}{% if not loop.last %}, {% endif %}
      {% endfor %}
    {% endif %}
  </li>
  {% endfor %}
</ul>
{% endif %}

{% if tags %}
<p>Tags:
  {% for t in tags %}
    <a href="/tags/{{ t.name }}">{{ t.name }}</a>{% if not loop.last %}, {% endif %}
  {% endfor %}
</p>
{% endif %}
{% endif %}

<hr>

<h3>Comments</h3>
<ul>
  {% for c in comments %}
    <li>{{ c.content }} — {{ c.created_at.strftime("%Y-%m-%d %H:%M") }} ({{ c.user.display_name if c.user else "Unknown" }})</li>
  {% endfor %}
</ul>

{% if current_user %}
<form action="/comments" method="post">
  <input type="hidden" name="report_id" value="{{ report.id }}">
  <textarea name="content" rows="3" cols="60" placeholder="Write a comment..."></textarea><br>
  <button type="submit">Post Comment</button>
</form>
{% else %}
<p><a href="/login">Login</a> to comment.</p>
{% endif %}

{% endblock %}
